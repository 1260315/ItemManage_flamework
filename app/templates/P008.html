<!DOCTYPE html>
<html>

<header>
    <meta charset="UTF-8">
    <title>備品管理システム</title>
</header>

<div style="text-align: center;">
    <h1>備品登録・削除業務</h1>
</div>



<body>
    
    <form id="searchForm" method="get" action="/items" onkeydown="return event.key !== 'Enter';">
        <table style="margin-left: auto; margin-right: auto;">
            <tr>
                <td><input type="text" name="id" placeholder="備品ID" value="{{ request.args.get('id','') }}"></td>
                <td><input type="text" name="name" placeholder="備品名" value="{{ request.args.get('name','') }}"></td>
            </tr>
            <tr>
                <td><input type="text" name="created_at" placeholder="登録日" value="{{ request.args.get('created_at','') }}"></td>
                <td><input type="text" name="registrant_id" placeholder="登録者" value="{{ request.args.get('registrant_id','') }}"></td>
            </tr>
        </table>
        <div style="text-align: center;">
            <p>カテゴリ:<br>
                <input name="category_id[]" value="1" type="checkbox" {% if "1" in request.args.getlist('category_id[]' ) %}checked{%endif%}>PC
                <input name="category_id[]" value="2" type="checkbox" {% if "2" in request.args.getlist('category_id[]' ) %}checked{%endif%}>モニター
                <input name="category_id[]" value="3" type="checkbox" {% if "3" in request.args.getlist('category_id[]' ) %}checked{%endif%}>マウス
                <input name="category_id[]" value="4" type="checkbox" {% if "4" in request.args.getlist('category_id[]' ) %}checked{%endif%}>キーボード
                <input name="category_id[]" value="5" type="checkbox" {% if "5" in request.args.getlist('category_id[]' ) %}checked{%endif%}>プリンター
                <input name="category_id[]" value="6" type="checkbox" {% if "6" in request.args.getlist('category_id[]' ) %}checked{%endif%}>その他
            </p>
            <input type="submit" value="検索">
        </div><br>
    </form>
        {% if rows %}
        <table id="ages" border="1" style="margin-left: auto; margin-right: auto;">
        <tr>
            <th>備品ID <button class="sortBtn" style="width: 1.5em; height: 1.5em; text-align: center;padding: 0;" type="button" data-sort="id" >{%if session.sortOrder != "id"%} {% elif session.sortDirection%}▼{% else %}▲{% endif %}</button></th>
            <th>備品名 <button class="sortBtn" style="width: 1.5em; height: 1.5em; text-align: center;padding: 0;" type="button" data-sort="name" >{%if session.sortOrder != "name" %} {% elif session.sortDirection%}▼{% else %}▲{% endif %}</button></th>
            <th>登録日 <button class="sortBtn" style="width: 1.5em; height: 1.5em; text-align: center;padding: 0;" type="button" data-sort="created_at" >{%if session.sortOrder != "created_at" %} {% elif session.sortDirection%}▼{% else %}▲{% endif %}</button></th>
            <th>登録者 <button class="sortBtn" style="width: 1.5em; height: 1.5em; text-align: center;padding: 0;" type="button" data-sort="registrant_id" >{%if session.sortOrder != "registrant_id" %} {% elif session.sortDirection%}▼{% else %}▲{% endif %}</button></th>
            <th>カテゴリ <!--<button class="sortBtn" style="width: 1.5em; height: 1.5em; text-align: center;padding: 0;" type="button" data-sort="category_id">{%if session.sortOrder != "category_id" %} {% elif session.sortDirection%}▼{% else %}▲{% endif %}</button>--></th>
            <th>備考</th>
            <th>編集</th>
            <th>削除</th>
        </tr>
        {% for row in rows %}
        <tr>
            {% for key, value in row.items() %}
            <td>
                {{ value }}
            </td>
            {% endfor %}
            <td>
                <button>編集</button>
            </td>
            
            <td>
                {% if session.studentID|string == row.reg|string or session.authority == 0 %}
                <form method="POST" action="/delete_item" style="display: inline;">
                <button type="submit" name="del" value="{{row.id}}">削除</button>
                </form>
                {% else %}
                {% endif %}
            </td>
            
        </tr>
        {% endfor %}
        </table>
        {%else%}
        <div style="text-align: center; font-size: larger;">検索に何もヒットしませんでした．</div>
        {%endif%}
</body>
<script>
// ソートボタン押下時に検索条件を維持して GET
document.querySelectorAll('.sortBtn').forEach(btn => {
    btn.addEventListener('click', function() {
        const form = document.getElementById("searchForm");
        const params = new URLSearchParams(new FormData(form));
        params.set('sort', btn.dataset.sort);
        window.location.href = "/search" + "?" + params.toString();
    });
});
</script>
</html>